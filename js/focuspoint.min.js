!function(t, e) {
    "use strict";
    e.IFA = {
        Models: {},
        Collections: {},
        Views: {},
        css: {
            _imageFocus: "image-focus",
            imageFocus: {
                _wrapper: "image-focus__wrapper",
                _img: "image-focus__img",
                _point: "image-focus__point",
                _clickarea: "image-focus__clickarea",
                _button: "image-focus__button"
            },
            _button: "button",
            button: {
                _primary: "button-primary",
                _disabled: "button-disabled"
            }
        },
        CalcService: {
            minMaxRange: function(t, e, i) {
                return Math.min(i, Math.max(e, t));
            }
        }
    }, t(document).on("ready", function() {
        new IFA.Views.ImageFocus({});
    });
}(jQuery, window), function(t, e) {
    "use strict";
    IFA.Models.Attachment = Backbone.Model.extend({
        url: ajaxurl,
        apiArgs: [ "action" ],
        id: !1,
        defaults: {
            src: !1,
            width: !1,
            height: !1,
            offset: {
                x: !1,
                y: !1
            },
            focusPointOrigin: {
                x: !1,
                y: !1
            },
            focusPoint: {
                x: 50,
                y: 50
            },
            differState: !1,
            ajaxState: !1
        },
        $img: !1,
        initialize: function(t) {
            var e = this;
            this.$img = t.$img, this.fetchAttachmentData(), this.on("change:focusPointOrigin", function() {
                e.setDifferState(!0);
            }, this), this.on("change:differState", this.resetAjaxState, this);
        },
        fetchAttachmentData: function() {
            var e = this;
            this.fetch({
                url: ajaxurl + "?action=get-focuspoint",
                data: t.param({
                    id: this.id
                }),
                success: function(t, i, s) {
                    if (!0 === i.success) try {
                        e.validateFocusPoint(i), e.set({
                            src: i.src
                        }), e.set({
                            focusPointOrigin: i.focusPoint
                        }), e.set({
                            focusPoint: i.focusPoint
                        });
                    } catch (t) {
                        console.log(t);
                    }
                },
                error: function(t, e, i) {
                    console.log(e);
                }
            });
        },
        setDifferState: function(t) {
            var e = this, i = this.get("focusPointOrigin"), s = this.get("focusPoint"), o = !1;
            i.x !== s.x && (o = !0), i.y !== s.y && (o = !0), this.set("differState", o), !0 !== t && !1 !== o || this.once("change:focusPoint", function() {
                e.setDifferState(!1);
            }, this);
        },
        resetAjaxState: function() {
            !0 === this.differState && self.model.set("ajaxState", !1);
        },
        validateFocusPoint: function(t) {
            if (!t.focusPoint.hasOwnProperty("x") || !t.focusPoint.hasOwnProperty("y")) throw "Wrong object properties";
        }
    });
}(jQuery, window), function(t, e) {
    IFA.Models.FocusInterface = Backbone.Model.extend({
        defaults: {
            width: 0,
            height: 0,
            radius: 0,
            offset: {
                x: 0,
                y: 0
            },
            position: {
                x: 0,
                y: 0
            },
            clickPosition: {
                x: 0,
                y: 0
            },
            initState: !1,
            moveState: !1,
            activeState: !1,
            hoverState: !1
        },
        initialize: function() {}
    });
}(jQuery, window), function(t, e) {
    "use strict";
    IFA.Views.Attachment = Backbone.View.extend({
        initialize: function(i, s) {
            this.focusInterface = i.focusInterface, t(e).on("resize", _.bind(this.updateDimensions, this)), 
            this.model.once("change:focusPoint", this.updateDimensions, this), this.model.on("change:focusPointOrigin", this.updateDimensions, this), 
            this.focusInterface.on("change:activeState", this.updateDimensions, this);
        },
        updateDimensions: function() {
            var t = this.model.$img, e = {
                x: t.offset().left,
                y: t.offset().top
            };
            this.model.set({
                width: t.width(),
                height: t.height(),
                offset: e
            });
        }
    });
}(jQuery, window), function(t, e) {
    "use strict";
    IFA.Views.Cropbutton = Backbone.View.extend({
        defaults: {
            ajaxState: !1
        },
        $cropButton: !1,
        initialize: function(e, i) {
            var s = this, o = '<button type="button" class="' + IFA.css._button + " " + IFA.css.button._disabled + " crop-attachment " + IFA.css.imageFocus._button + '">' + focusPointL10n.cropButton + "</button>";
            this.$el.append(o), this.$cropButton = t("." + IFA.css.imageFocus._button), this.$cropButton.on("click", function() {
                s.model.set("ajaxState", "cropping"), s.model.save({}, {
                    url: ajaxurl + "?action=initialize-crop",
                    success: function(t, e, i) {
                        if (!0 === e.success) try {
                            s.model.validateFocusPoint(e), s.model.set({
                                focusPointOrigin: e.focusPoint
                            }), s.model.set("ajaxState", "success");
                        } catch (t) {
                            console.log(t), s.model.set("ajaxState", "failed");
                        }
                    },
                    error: function(t, e, i) {
                        s.model.set("ajaxState", "failed"), console.log(e);
                    }
                });
            }), this.model.on("change:differState", this.differStateHandler, this), this.model.on("change:ajaxState", this.ajaxStateHandler, this);
        },
        differStateHandler: function() {
            !0 === this.model.get("differState") ? this.highlight() : this.disable();
        },
        ajaxStateHandler: function() {
            switch (this.model.get("ajaxState")) {
              case "cropping":
                this.setButtonText(focusPointL10n.cropButtonProgress), this.disable();
                break;

              case "success":
                this.setButtonText(focusPointL10n.cropButtonSuccess), this.disable();
                break;

              case "failed":
                this.setButtonText(focusPointL10n.cropButtonFailed), this.activate();
                break;

              default:
                this.setButtonText(focusPointL10n.cropButton);
            }
        },
        setButtonText: function(t) {
            this.$cropButton.text(t);
        },
        highlight: function() {
            this.$cropButton.removeClass(IFA.css.button._disabled).addClass(IFA.css.button._primary).text(focusPointL10n.cropButton);
        },
        activate: function() {
            this.$cropButton.removeClass(IFA.css.button._disabled).removeClass(IFA.css.button._primary);
        },
        disable: function() {
            this.$cropButton.removeClass(IFA.css.button._primary).addClass(IFA.css.button._disabled);
        }
    });
}(jQuery, window), function(t, e) {
    "use strict";
    IFA.Views.FocusInterface = Backbone.View.extend({
        template: !1,
        $img: !1,
        imgHtml: !1,
        $imageFocus: !1,
        $container: !1,
        $clickarea: !1,
        $focusPoint: !1,
        initialize: function(t, e) {
            this.attachment = t.attachment, this.template = wp.template("IFA-focus-point"), 
            this.$img = e.$img, this.$img.addClass(IFA.css.imageFocus._img), this.imgHtml = this.$img.get(0).outerHTML, 
            this.$img.wrap('<div class="IFA-container"></div>'), this.$container = this.$el.find(".IFA-container"), 
            this.render(), this.model.on("change:position", this.updateFocusPoint, this), this.attachment.once("change:focusPoint", this.updateDimensionData, this), 
            this.attachment.once("change:focusPoint", this.updateFocusPoint, this), this.setStateEvent("hoverState", "is-hover"), 
            this.setStateEvent("activeState", "is-active"), this.setStateEvent("moveState", "is-move"), 
            this.setStateEvent("initState", "is-initialized");
        },
        events: {},
        render: function() {
            var t = this.attachment.get("focusPoint");
            this.$container.html(this.template({
                imageObject: this.imgHtml,
                left: t.x,
                top: t.y,
                state: "is-initialized"
            })), this.setElements(), this.setEvents(), this.model.set("initState", !0);
        },
        setElements: function() {
            this.$imageFocus = this.$container.find("." + IFA.css._imageFocus), this.$clickarea = this.$container.find("." + IFA.css.imageFocus._clickarea), 
            this.$focusPoint = this.$container.find("." + IFA.css.imageFocus._point), this.attachment.$img = this.$img = this.$container.find("." + IFA.css.imageFocus._img), 
            this.attachment.$img = this.$img;
        },
        setEvents: function() {
            var i = this;
            this.$clickarea.on("mousedown", function(t) {
                1 === t.which && i.startMove(t, !0).move(t);
            }), this.$focusPoint.on("mousedown", function(t) {
                1 === t.which && i.startMove(t);
            }).on("mouseenter", function() {
                i.model.set("hoverState", !0);
            }).on("mouseleave", function() {
                i.model.set("hoverState", !1);
            }), t(e).on("mouseup", function(t) {
                1 === t.which && i.model.set({
                    moveState: !1,
                    activeState: !1
                });
            }).on("mousemove", function(t) {
                i.move(t);
            }).on("resize", function() {
                i.updateDimensionData().updateFocusPoint();
            });
        },
        startMove: function(t, e) {
            return this.updateDimensionData().updateClickPosition(t, e), this.model.set({
                moveState: !0,
                activeState: !0
            }), this;
        },
        move: function(t) {
            if (!1 === this.model.get("moveState")) return !1;
            var e = {
                x: t.pageX,
                y: t.pageY
            }, i = {}, s = this.attachment.get("offset"), o = this.model.get("clickPosition"), n = this.attachment.get("width"), a = this.attachment.get("height");
            i.x = e.x - s.x - o.x, i.y = e.y - s.y - o.y, i.x = IFA.CalcService.minMaxRange(i.x, 0, n), 
            i.y = IFA.CalcService.minMaxRange(i.y, 0, a);
            var c = {};
            return c.x = i.x / n * 100, c.y = i.y / a * 100, this.attachment.set({
                focusPoint: c
            }), this.model.set({
                position: i
            }), this;
        },
        updateFocusPoint: function() {
            var t = this.attachment.get("focusPoint"), e = this.model.get("position"), i = this.model.get("radius"), s = this.attachment.get("width"), o = this.attachment.get("height"), n = this.attachment.get("src"), a = {};
            return a.x = 0 - (e.x - i), a.y = 0 - (e.y - i), this.$focusPoint.css({
                left: t.x + "%",
                top: t.y + "%",
                backgroundImage: 'url("' + n + '")',
                backgroundSize: s + "px " + o + "px ",
                backgroundPosition: a.x + "px " + a.y + "px "
            }), this;
        },
        updateClickPosition: function(t, e) {
            var i = {
                x: 0,
                y: 0
            };
            if (!0 !== e) {
                var s = {
                    x: t.pageX,
                    y: t.pageY
                }, o = this.model.get("offset");
                (i = {}).x = s.x - o.x, i.y = s.y - o.y;
            }
            return this.model.set({
                clickPosition: i
            }), this;
        },
        updateDimensionData: function() {
            this.model.width = this.$focusPoint.width(), this.model.height = this.$focusPoint.height();
            var t = this.model.width / 2;
            this.model.set("radius", t);
            var e = this.$focusPoint.offset();
            this.model.set({
                offset: {
                    x: e.left + t,
                    y: e.top + t
                }
            });
            var i = this.attachment.get("focusPoint"), s = {
                x: i.x / 100 * this.attachment.get("width"),
                y: i.y / 100 * this.attachment.get("height")
            };
            return this.model.set({
                position: s
            }), this;
        },
        setStateEvent: function(t, e) {
            var i = this;
            this.model.on("change:" + t, function() {
                i.toggleClassState(t, e);
            });
        },
        toggleClassState: function(t, e) {
            var i = this.model.get(t);
            this.$imageFocus.toggleClass(e, i);
        }
    });
}(jQuery, window), function(t, e) {
    "use strict";
    IFA.Views.ImageFocus = Backbone.View.extend({
        initialize: function() {
            var e = this;
            setInterval(function() {
                var i = t(".attachment-details");
                i.length && !t(".IFA-initialized").length && i.each(function() {
                    var i = t(this);
                    e.startApplication(i);
                });
            }, 500);
        },
        startApplication: function(t) {
            var e = t.find(".details-image");
            t.addClass("IFA-initialized");
            var i = new IFA.Models.Attachment({
                id: t.data("id"),
                $img: e
            }), s = new IFA.Models.FocusInterface({});
            new IFA.Views.Attachment({
                model: i,
                focusInterface: s
            }), new IFA.Views.FocusInterface({
                el: t,
                model: s,
                attachment: i
            }, {
                $img: e
            }), new IFA.Views.Cropbutton({
                el: t.find(".attachment-actions"),
                model: i
            });
            s.set("state.init", !0);
        }
    });
}(jQuery, window);
//# sourceMappingURL=focuspoint.min.js.map