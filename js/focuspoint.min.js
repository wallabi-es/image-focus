!function(t,o,i){"use strict";function n(o,i){this.element=o,this.options=t.extend({},a,i),this._defaults=a,this._name=e,this.init()}var e="imageFocus",a={},s={id:!1,dimension:{width:!1,height:!1},position:{x:!1,y:!1},focusPoint:{x:50,y:50}},u={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea",button:"image-focus__button"},button:{self:"button",primary:"button-primary",disabled:"button-disabled"}},c={move:!1},m={crop:!1};n.prototype={init:function(){this.getAttachmentData(),this.addImageElements(),this.setImageDimensionData(),this.addCropButton(),this.moveFocusPointActions(),t("."+u.imageFocus.button).on("click",this.sendImageCropDataByAjax),t(o).on("resize",this.setImageDimensionData)},getAttachmentData:function(){s.id=t(this.element).data("id"),t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:s},dataType:"json"}).done(function(o){s.focusPoint={x:50,y:50},!0===o.success&&(s.focusPoint=o.focusPoint),t("."+u.imageFocus.point).css({display:"block",left:s.focusPoint.x+"%",top:s.focusPoint.y+"%"})})},setImageDimensionData:function(){var o=t("."+u.imageFocus.img);s.dimension.width=o.width(),s.dimension.height=o.height(),s.position.x=o.offset().left,s.position.y=o.offset().top},addImageElements:function(){var o,i=t(".edit-attachment-frame .attachment-media-view .details-image");i.addClass(u.imageFocus.img),i.wrap('<div class="'+u.imageFocus.self+'"><div class="'+u.imageFocus.wrapper+'"></div></div>'),(o=t("."+u.imageFocus.wrapper)).append('<div class="'+u.imageFocus.point+'"></div>'),o.append('<div class="'+u.imageFocus.clickarea+'"></div>')},moveFocusPointActions:function(){var i=t("."+u.imageFocus.point);i.on("mousedown",function(){c.move=!0,n.prototype.setImageDimensionData(),n.prototype.highlightCropButton()}),i.on("mouseup",function(){c.move=!1}),t(o).on("mousemove",function(t){n.prototype.moveFocusPoint(t)})},moveFocusPoint:function(o){if(!1===c.move)return!1;var i=o.pageX-s.position.x,n=o.pageY-s.position.y;s.focusPoint.x=i/s.dimension.width*100,s.focusPoint.y=n/s.dimension.height*100,s.focusPoint.x<0?s.focusPoint.x=0:s.focusPoint.x>100&&(s.focusPoint.x=100),s.focusPoint.y<0?s.focusPoint.y=0:s.focusPoint.y>100&&(s.focusPoint.y=100),t("."+u.imageFocus.point).css({left:s.focusPoint.x+"%",top:s.focusPoint.y+"%"})},addCropButton:function(){var o='<button type="button" class="'+u.button.self+" "+u.button.disabled+" crop-attachment "+u.imageFocus.button+'">'+focusPointL10n.cropButton+"</button>";t(this.element).find(".attachment-actions").append(o)},highlightCropButton:function(){var o=t("."+u.imageFocus.button);o.removeClass(u.button.disabled),o.text(focusPointL10n.cropButton),o.addClass(u.button.primary)},activateCropButton:function(){var o=t("."+u.imageFocus.button);o.removeClass(u.button.disabled),o.removeClass(u.button.primary)},disableCropButton:function(){var o=t("."+u.imageFocus.button);o.removeClass(u.button.primary),o.addClass(u.button.disabled)},sendImageCropDataByAjax:function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:s},dataType:"json",beforeSend:function(){if(!0===m.crop)return!1;t("."+u.imageFocus.button).text("Cropping..."),n.prototype.disableCropButton(),m.crop=!0}}).done(function(o){var i=t("."+u.imageFocus.button);!1===o.success?(n.prototype.activateCropButton(),i.text("Please try again")):i.text("Done!"),m.crop=!1})}},t.fn[e]=function(o){return this.each(function(){t.data(this,"plugin_"+e)||t.data(this,"plugin_"+e,new n(this,o))})}}(jQuery,window,document),function(t,o,i){t(i).on("ready",function(){setInterval(function(){var o=t(".attachment-details");if(o.find(".details-image").length&&!t(".image-focus").length)try{o.imageFocus()}catch(t){console.log(t)}},500)})}(jQuery,window,document);