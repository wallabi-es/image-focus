!function(t,o,a){"use strict";var n={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea",button:"image-focus__button"},button:{self:"button",primary:"button-primary",disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,e){var i=this;i.$el=t(a),i.el=a,i.$el.data("imageFocus.focusPoint",i),i.init=function(){i.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,e),i.getAttachmentData(),i.addImageElements(),i.getImageDimensionData(),i.cropButton.init(),i.moveFocusPointActions(),t("."+n.imageFocus.button).on("click",i.sendImageCropDataByAjax),t(o).on("resize",i.getImageDimensionData)},i.getAttachmentData=function(){i._attachment.id=t(i.el).data("id"),t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:this._attachment},dataType:"json"}).done(function(o){!0===o.success&&(i._attachment.focusPoint=o.focusPoint),t("."+n.imageFocus.point).css({display:"block",left:i._attachment.focusPoint.x+"%",top:i._attachment.focusPoint.y+"%"})})},i.getImageDimensionData=function(){var o=t("."+n.imageFocus.img);i._attachment.dimension.width=o.width(),i._attachment.dimension.height=o.height(),i._attachment.position.x=o.offset().left,i._attachment.position.y=o.offset().top},i.addImageElements=function(){var o,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(n.imageFocus.img),a.wrap('<div class="'+n.imageFocus.self+'"><div class="'+n.imageFocus.wrapper+'"></div></div>'),(o=t("."+n.imageFocus.wrapper)).append('<div class="'+n.imageFocus.point+'"></div>'),o.append('<div class="'+n.imageFocus.clickarea+'"></div>')},i.moveFocusPointActions=function(){var a=t("."+n.imageFocus.point);a.on("mousedown",function(){i._focusPointState.move=!0,i.getImageDimensionData(),i.cropButton.highlight()}),a.on("mouseup",function(){i._focusPointState.move=!1}),t(o).on("mousemove",function(t){i.moveFocusPoint(t)})},i.moveFocusPoint=function(o){if(!1===i._focusPointState.move)return!1;var a=o.pageX-i._attachment.position.x,e=o.pageY-i._attachment.position.y;i._attachment.focusPoint.x=a/i._attachment.dimension.width*100,i._attachment.focusPoint.y=e/i._attachment.dimension.height*100,i._attachment.focusPoint.x<0?i._attachment.focusPoint.x=0:i._attachment.focusPoint.x>100&&(i._attachment.focusPoint.x=100),i._attachment.focusPoint.y<0?i._attachment.focusPoint.y=0:i._attachment.focusPoint.y>100&&(i._attachment.focusPoint.y=100),t("."+n.imageFocus.point).css({left:i._attachment.focusPoint.x+"%",top:i._attachment.focusPoint.y+"%"})},i.cropButton={_el:!1,init:function(){var o='<button type="button" class="'+n.button.self+" "+n.button.disabled+" crop-attachment "+n.imageFocus.button+'">'+focusPointL10n.cropButton+"</button>";t(i.el).find(".attachment-actions").append(o),i.cropButton._el=t("."+n.imageFocus.button)},highlight:function(){i.cropButton._el.removeClass(n.button.disabled),i.cropButton._el.text(focusPointL10n.cropButton),i.cropButton._el.addClass(n.button.primary)},activate:function(){i.cropButton._el.removeClass(n.button.disabled),i.cropButton._el.removeClass(n.button.primary)},disable:function(){i.cropButton._el.removeClass(n.button.primary),i.cropButton._el.addClass(n.button.disabled)}},i.sendImageCropDataByAjax=function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:i._attachment},dataType:"json",beforeSend:function(){if(!0===i._ajaxState.crop)return!1;t("."+n.imageFocus.button).text("Cropping..."),i.cropButton.disable(),i._ajaxState.crop=!0}}).done(function(o){var a=t("."+n.imageFocus.button);!1===o.success?(i.cropButton.activate(),a.text("Please try again")):a.text("Done!"),i._ajaxState.crop=!1})},i._attachment={id:!1,dimension:{width:!1,height:!1},position:{x:!1,y:!1},focusPoint:{x:50,y:50}},i._focusPointState={move:!1},i._ajaxState={crop:!1},i.init()},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(o){return this.each(function(){new t.imageFocus.focusPoint(this,o)})}}(jQuery,window,document),function(t,o,a){t(a).on("ready",function(){setInterval(function(){var o=t(".attachment-details");if(o.find(".details-image").length&&!t(".image-focus").length)try{o.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);